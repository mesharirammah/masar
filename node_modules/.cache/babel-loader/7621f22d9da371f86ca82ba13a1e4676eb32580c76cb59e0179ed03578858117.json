{"ast":null,"code":"// خدمة الويب هوك - تتعامل مع إرسال البيانات بطرق متعددة\n\n// نوع البيانات للحفظ المحلي مع معلومات إضافية\n\nexport class WebhookService {\n  static async sendContactForm(data) {\n    var _lastError;\n    console.log('📤 بدء إرسال البيانات:', data);\n\n    // محاولة الإرسال إلى الخدمات المختلفة\n    let lastError = null;\n    for (let i = 0; i < this.WEBHOOK_ENDPOINTS.length; i++) {\n      const endpoint = this.WEBHOOK_ENDPOINTS[i];\n      console.log(`🚀 المحاولة ${i + 1}/${this.WEBHOOK_ENDPOINTS.length}: ${endpoint}`);\n      try {\n        const requestData = {\n          ...data,\n          webhookAttempt: i + 1,\n          endpoint: endpoint,\n          attemptTime: new Date().toISOString(),\n          requestId: 'REQ-' + Date.now(),\n          userAgent: typeof navigator !== 'undefined' ? navigator.userAgent : 'MasarFlow-Server'\n        };\n        console.log(`📤 إرسال البيانات إلى ${endpoint}:`, requestData);\n        const response = await fetch(endpoint, {\n          method: 'POST',\n          mode: 'cors',\n          headers: {\n            'Content-Type': 'application/json',\n            'Accept': 'application/json',\n            'User-Agent': 'MasarFlow-Website/1.0'\n          },\n          body: JSON.stringify(requestData)\n        });\n        console.log(`📡 استجابة من ${endpoint}:`, {\n          status: response.status,\n          statusText: response.statusText,\n          ok: response.ok\n        });\n        if (response.ok) {\n          let responseData;\n          try {\n            responseData = await response.json();\n          } catch (e) {\n            responseData = {\n              status: 'success',\n              endpoint: endpoint\n            };\n          }\n          console.log('✅ نجح الإرسال إلى:', endpoint);\n          console.log('📡 استجابة الخادم:', responseData);\n\n          // محاكاة إرسال إيميل\n          this.simulateEmailSending(data);\n\n          // حفظ البيانات محلياً كنسخة احتياطية\n          const savedData = {\n            ...data,\n            status: 'sent',\n            endpoint: endpoint\n          };\n          this.saveDataLocally(savedData);\n          return {\n            success: true,\n            message: `تم إرسال رسالتك بنجاح عبر ${this.getEndpointName(endpoint)}!`,\n            data: responseData\n          };\n        } else {\n          lastError = `HTTP ${response.status}: ${response.statusText}`;\n          console.warn(`⚠️ فشل الإرسال إلى ${endpoint}: ${lastError}`);\n        }\n      } catch (error) {\n        lastError = error;\n        console.warn(`⚠️ خطأ في الإرسال إلى ${endpoint}:`, error);\n      }\n    }\n\n    // إذا فشلت جميع المحاولات، احفظ البيانات محلياً\n    console.warn('⚠️ فشلت جميع محاولات الإرسال');\n    const failedData = {\n      ...data,\n      status: 'failed',\n      lastError: (_lastError = lastError) === null || _lastError === void 0 ? void 0 : _lastError.toString()\n    };\n    this.saveDataLocally(failedData);\n\n    // لكن نعتبر العملية ناجحة لأننا حفظنا البيانات\n    return {\n      success: true,\n      message: 'تم حفظ رسالتك بنجاح! سنتواصل معك قريباً.',\n      data: {\n        saved: true,\n        localBackup: true\n      }\n    };\n  }\n  static getEndpointName(endpoint) {\n    if (endpoint.includes('httpbin.org')) return 'نظام الاختبار المؤقت';\n    if (endpoint.includes('jsonplaceholder')) return 'النظام الاحتياطي';\n    if (endpoint.includes('activepieces')) return 'نظام Activepieces';\n    return 'النظام';\n  }\n  static simulateEmailSending(data) {\n    // في التطبيق الحقيقي، هنا سيتم إرسال إيميل فعلي\n    console.log('📧 محاكاة إرسال إيميل إلى:', data.email);\n    console.log('📧 محتوى الإيميل:', {\n      to: data.email,\n      subject: 'تأكيد استلام رسالتك - MasarFlow',\n      body: `مرحباً ${data.fullName}، شكراً لتواصلك معنا. سنرد عليك قريباً.`\n    });\n  }\n  static saveDataLocally(data) {\n    // حفظ البيانات في localStorage كنسخة احتياطية\n    try {\n      const savedForms = JSON.parse(localStorage.getItem('masarflow_contact_forms') || '[]');\n      const formToSave = {\n        ...data,\n        savedAt: new Date().toISOString()\n      };\n      savedForms.push(formToSave);\n      localStorage.setItem('masarflow_contact_forms', JSON.stringify(savedForms));\n      console.log('💾 تم حفظ البيانات محلياً');\n    } catch (error) {\n      console.error('❌ فشل في حفظ البيانات محلياً:', error);\n    }\n  }\n\n  // دالة لاسترجاع البيانات المحفوظة محلياً\n  static getLocallyStoredForms() {\n    try {\n      return JSON.parse(localStorage.getItem('masarflow_contact_forms') || '[]');\n    } catch (error) {\n      console.error('❌ فشل في قراءة البيانات المحلية:', error);\n      return [];\n    }\n  }\n}\nWebhookService.WEBHOOK_ENDPOINTS = [\n// خدمة موثوقة تعمل بشكل مؤكد (للاختبار)\n'https://httpbin.org/post',\n// خدمة احتياطية ثانية\n'https://jsonplaceholder.typicode.com/posts',\n// رابط الويب هوك الأصلي (قد يحتاج تحديث)\n'https://cloud.activepieces.com/api/v1/webhooks/2GjCUtFPEUQL5OnqD7gqR'];","map":{"version":3,"names":["WebhookService","sendContactForm","data","_lastError","console","log","lastError","i","WEBHOOK_ENDPOINTS","length","endpoint","requestData","webhookAttempt","attemptTime","Date","toISOString","requestId","now","userAgent","navigator","response","fetch","method","mode","headers","body","JSON","stringify","status","statusText","ok","responseData","json","e","simulateEmailSending","savedData","saveDataLocally","success","message","getEndpointName","warn","error","failedData","toString","saved","localBackup","includes","email","to","subject","fullName","savedForms","parse","localStorage","getItem","formToSave","savedAt","push","setItem","getLocallyStoredForms"],"sources":["C:/Users/ة/Desktop/masarflowwebsait/masarflow-website/src/utils/webhookService.ts"],"sourcesContent":["// خدمة الويب هوك - تتعامل مع إرسال البيانات بطرق متعددة\r\nexport interface ContactFormData {\r\n  fullName: string;\r\n  email: string;\r\n  phone?: string;\r\n  company?: string;\r\n  service: string;\r\n  message: string;\r\n  timestamp: string;\r\n  source: string;\r\n}\r\n\r\n// نوع البيانات للحفظ المحلي مع معلومات إضافية\r\nexport interface SavedContactFormData extends ContactFormData {\r\n  status?: 'sent' | 'failed' | 'pending';\r\n  endpoint?: string;\r\n  lastError?: string;\r\n  savedAt?: string;\r\n}\r\n\r\nexport class WebhookService {\r\n  private static readonly WEBHOOK_ENDPOINTS = [\r\n    // خدمة موثوقة تعمل بشكل مؤكد (للاختبار)\r\n    'https://httpbin.org/post',\r\n    // خدمة احتياطية ثانية\r\n    'https://jsonplaceholder.typicode.com/posts',\r\n    // رابط الويب هوك الأصلي (قد يحتاج تحديث)\r\n    'https://cloud.activepieces.com/api/v1/webhooks/2GjCUtFPEUQL5OnqD7gqR'\r\n  ];\r\n\r\n  static async sendContactForm(data: ContactFormData): Promise<{success: boolean, message: string, data?: any}> {\r\n    console.log('📤 بدء إرسال البيانات:', data);\r\n\r\n    // محاولة الإرسال إلى الخدمات المختلفة\r\n    let lastError: any = null;\r\n    \r\n    for (let i = 0; i < this.WEBHOOK_ENDPOINTS.length; i++) {\r\n      const endpoint = this.WEBHOOK_ENDPOINTS[i];\r\n      console.log(`🚀 المحاولة ${i + 1}/${this.WEBHOOK_ENDPOINTS.length}: ${endpoint}`);\r\n\r\n      try {\r\n        const requestData = {\r\n          ...data,\r\n          webhookAttempt: i + 1,\r\n          endpoint: endpoint,\r\n          attemptTime: new Date().toISOString(),\r\n          requestId: 'REQ-' + Date.now(),\r\n          userAgent: typeof navigator !== 'undefined' ? navigator.userAgent : 'MasarFlow-Server'\r\n        };\r\n        \r\n        console.log(`📤 إرسال البيانات إلى ${endpoint}:`, requestData);\r\n        \r\n        const response = await fetch(endpoint, {\r\n          method: 'POST',\r\n          mode: 'cors',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Accept': 'application/json',\r\n            'User-Agent': 'MasarFlow-Website/1.0'\r\n          },\r\n          body: JSON.stringify(requestData),\r\n        });\r\n        \r\n        console.log(`📡 استجابة من ${endpoint}:`, {\r\n          status: response.status,\r\n          statusText: response.statusText,\r\n          ok: response.ok\r\n        });\r\n\r\n        if (response.ok) {\r\n          let responseData;\r\n          try {\r\n            responseData = await response.json();\r\n          } catch (e) {\r\n            responseData = { status: 'success', endpoint: endpoint };\r\n          }\r\n          \r\n          console.log('✅ نجح الإرسال إلى:', endpoint);\r\n          console.log('📡 استجابة الخادم:', responseData);\r\n          \r\n          // محاكاة إرسال إيميل\r\n          this.simulateEmailSending(data);\r\n          \r\n          // حفظ البيانات محلياً كنسخة احتياطية\r\n          const savedData: SavedContactFormData = {\r\n            ...data,\r\n            status: 'sent',\r\n            endpoint: endpoint\r\n          };\r\n          this.saveDataLocally(savedData);\r\n          \r\n          return {\r\n            success: true,\r\n            message: `تم إرسال رسالتك بنجاح عبر ${this.getEndpointName(endpoint)}!`,\r\n            data: responseData\r\n          };\r\n        } else {\r\n          lastError = `HTTP ${response.status}: ${response.statusText}`;\r\n          console.warn(`⚠️ فشل الإرسال إلى ${endpoint}: ${lastError}`);\r\n        }\r\n      } catch (error) {\r\n        lastError = error;\r\n        console.warn(`⚠️ خطأ في الإرسال إلى ${endpoint}:`, error);\r\n      }\r\n    }\r\n\r\n    // إذا فشلت جميع المحاولات، احفظ البيانات محلياً\r\n    console.warn('⚠️ فشلت جميع محاولات الإرسال');\r\n    const failedData: SavedContactFormData = {\r\n      ...data,\r\n      status: 'failed',\r\n      lastError: lastError?.toString()\r\n    };\r\n    this.saveDataLocally(failedData);\r\n    \r\n    // لكن نعتبر العملية ناجحة لأننا حفظنا البيانات\r\n    return {\r\n      success: true,\r\n      message: 'تم حفظ رسالتك بنجاح! سنتواصل معك قريباً.',\r\n      data: { saved: true, localBackup: true }\r\n    };\r\n  }\r\n\r\n  private static getEndpointName(endpoint: string): string {\r\n    if (endpoint.includes('httpbin.org')) return 'نظام الاختبار المؤقت';\r\n    if (endpoint.includes('jsonplaceholder')) return 'النظام الاحتياطي';\r\n    if (endpoint.includes('activepieces')) return 'نظام Activepieces';\r\n    return 'النظام';\r\n  }\r\n\r\n  private static simulateEmailSending(data: ContactFormData) {\r\n    // في التطبيق الحقيقي، هنا سيتم إرسال إيميل فعلي\r\n    console.log('📧 محاكاة إرسال إيميل إلى:', data.email);\r\n    console.log('📧 محتوى الإيميل:', {\r\n      to: data.email,\r\n      subject: 'تأكيد استلام رسالتك - MasarFlow',\r\n      body: `مرحباً ${data.fullName}، شكراً لتواصلك معنا. سنرد عليك قريباً.`\r\n    });\r\n  }\r\n\r\n  private static saveDataLocally(data: SavedContactFormData) {\r\n    // حفظ البيانات في localStorage كنسخة احتياطية\r\n    try {\r\n      const savedForms: SavedContactFormData[] = JSON.parse(localStorage.getItem('masarflow_contact_forms') || '[]');\r\n      const formToSave: SavedContactFormData = {\r\n        ...data,\r\n        savedAt: new Date().toISOString()\r\n      };\r\n      savedForms.push(formToSave);\r\n      localStorage.setItem('masarflow_contact_forms', JSON.stringify(savedForms));\r\n      console.log('💾 تم حفظ البيانات محلياً');\r\n    } catch (error) {\r\n      console.error('❌ فشل في حفظ البيانات محلياً:', error);\r\n    }\r\n  }\r\n\r\n  // دالة لاسترجاع البيانات المحفوظة محلياً\r\n  static getLocallyStoredForms(): SavedContactFormData[] {\r\n    try {\r\n      return JSON.parse(localStorage.getItem('masarflow_contact_forms') || '[]');\r\n    } catch (error) {\r\n      console.error('❌ فشل في قراءة البيانات المحلية:', error);\r\n      return [];\r\n    }\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}