{"ast":null,"code":"import _objectSpread from\"C:/Users/\\u0629/Desktop/masarflowwebsait/masarflow-website/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// خدمة الويب هوك - تتعامل مع إرسال البيانات بطرق متعددة\n// نوع البيانات للحفظ المحلي مع معلومات إضافية\nexport class WebhookService{static async sendContactForm(data){var _lastError;console.log('📤 بدء إرسال البيانات:',data);// محاولة الإرسال إلى الخدمات المختلفة\nlet lastError=null;for(let i=0;i<this.WEBHOOK_ENDPOINTS.length;i++){const endpoint=this.WEBHOOK_ENDPOINTS[i];console.log(\"\\uD83D\\uDE80 \\u0627\\u0644\\u0645\\u062D\\u0627\\u0648\\u0644\\u0629 \".concat(i+1,\"/\").concat(this.WEBHOOK_ENDPOINTS.length,\": \").concat(endpoint));try{const response=await fetch(endpoint,{method:'POST',mode:'cors',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify(_objectSpread(_objectSpread({},data),{},{webhookAttempt:i+1,endpoint:endpoint,attemptTime:new Date().toISOString()}))});if(response.ok){let responseData;try{responseData=await response.json();}catch(e){responseData={status:'success',endpoint:endpoint};}console.log('✅ نجح الإرسال إلى:',endpoint);console.log('📡 استجابة الخادم:',responseData);// محاكاة إرسال إيميل\nthis.simulateEmailSending(data);// حفظ البيانات محلياً كنسخة احتياطية\nconst savedData=_objectSpread(_objectSpread({},data),{},{status:'sent',endpoint:endpoint});this.saveDataLocally(savedData);return{success:true,message:\"\\u062A\\u0645 \\u0625\\u0631\\u0633\\u0627\\u0644 \\u0631\\u0633\\u0627\\u0644\\u062A\\u0643 \\u0628\\u0646\\u062C\\u0627\\u062D \\u0639\\u0628\\u0631 \".concat(this.getEndpointName(endpoint),\"!\"),data:responseData};}else{lastError=\"HTTP \".concat(response.status,\": \").concat(response.statusText);console.warn(\"\\u26A0\\uFE0F \\u0641\\u0634\\u0644 \\u0627\\u0644\\u0625\\u0631\\u0633\\u0627\\u0644 \\u0625\\u0644\\u0649 \".concat(endpoint,\": \").concat(lastError));}}catch(error){lastError=error;console.warn(\"\\u26A0\\uFE0F \\u062E\\u0637\\u0623 \\u0641\\u064A \\u0627\\u0644\\u0625\\u0631\\u0633\\u0627\\u0644 \\u0625\\u0644\\u0649 \".concat(endpoint,\":\"),error);}}// إذا فشلت جميع المحاولات، احفظ البيانات محلياً\nconsole.warn('⚠️ فشلت جميع محاولات الإرسال');const failedData=_objectSpread(_objectSpread({},data),{},{status:'failed',lastError:(_lastError=lastError)===null||_lastError===void 0?void 0:_lastError.toString()});this.saveDataLocally(failedData);// لكن نعتبر العملية ناجحة لأننا حفظنا البيانات\nreturn{success:true,message:'تم حفظ رسالتك بنجاح! سنتواصل معك قريباً.',data:{saved:true,localBackup:true}};}static getEndpointName(endpoint){if(endpoint.includes('activepieces'))return'نظام MasarFlow';if(endpoint.includes('httpbin.org'))return'النظام الاحتياطي';return'النظام';}static simulateEmailSending(data){// في التطبيق الحقيقي، هنا سيتم إرسال إيميل فعلي\nconsole.log('📧 محاكاة إرسال إيميل إلى:',data.email);console.log('📧 محتوى الإيميل:',{to:data.email,subject:'تأكيد استلام رسالتك - MasarFlow',body:\"\\u0645\\u0631\\u062D\\u0628\\u0627\\u064B \".concat(data.fullName,\"\\u060C \\u0634\\u0643\\u0631\\u0627\\u064B \\u0644\\u062A\\u0648\\u0627\\u0635\\u0644\\u0643 \\u0645\\u0639\\u0646\\u0627. \\u0633\\u0646\\u0631\\u062F \\u0639\\u0644\\u064A\\u0643 \\u0642\\u0631\\u064A\\u0628\\u0627\\u064B.\")});}static saveDataLocally(data){// حفظ البيانات في localStorage كنسخة احتياطية\ntry{const savedForms=JSON.parse(localStorage.getItem('masarflow_contact_forms')||'[]');const formToSave=_objectSpread(_objectSpread({},data),{},{savedAt:new Date().toISOString()});savedForms.push(formToSave);localStorage.setItem('masarflow_contact_forms',JSON.stringify(savedForms));console.log('💾 تم حفظ البيانات محلياً');}catch(error){console.error('❌ فشل في حفظ البيانات محلياً:',error);}}// دالة لاسترجاع البيانات المحفوظة محلياً\nstatic getLocallyStoredForms(){try{return JSON.parse(localStorage.getItem('masarflow_contact_forms')||'[]');}catch(error){console.error('❌ فشل في قراءة البيانات المحلية:',error);return[];}}}WebhookService.WEBHOOK_ENDPOINTS=[// رابط الويب هوك الرئيسي\n'https://cloud.activepieces.com/api/v1/webhooks/2GjCUtFPEUQL5OnqD7gqR',// خدمة احتياطية موثوقة\n'https://httpbin.org/post'];","map":{"version":3,"names":["WebhookService","sendContactForm","data","_lastError","console","log","lastError","i","WEBHOOK_ENDPOINTS","length","endpoint","concat","response","fetch","method","mode","headers","body","JSON","stringify","_objectSpread","webhookAttempt","attemptTime","Date","toISOString","ok","responseData","json","e","status","simulateEmailSending","savedData","saveDataLocally","success","message","getEndpointName","statusText","warn","error","failedData","toString","saved","localBackup","includes","email","to","subject","fullName","savedForms","parse","localStorage","getItem","formToSave","savedAt","push","setItem","getLocallyStoredForms"],"sources":["C:/Users/ة/Desktop/masarflowwebsait/masarflow-website/src/utils/webhookService.ts"],"sourcesContent":["// خدمة الويب هوك - تتعامل مع إرسال البيانات بطرق متعددة\r\nexport interface ContactFormData {\r\n  fullName: string;\r\n  email: string;\r\n  phone?: string;\r\n  company?: string;\r\n  service: string;\r\n  message: string;\r\n  timestamp: string;\r\n  source: string;\r\n}\r\n\r\n// نوع البيانات للحفظ المحلي مع معلومات إضافية\r\nexport interface SavedContactFormData extends ContactFormData {\r\n  status?: 'sent' | 'failed' | 'pending';\r\n  endpoint?: string;\r\n  lastError?: string;\r\n  savedAt?: string;\r\n}\r\n\r\nexport class WebhookService {\r\n  private static readonly WEBHOOK_ENDPOINTS = [\r\n    // رابط الويب هوك الرئيسي\r\n    'https://cloud.activepieces.com/api/v1/webhooks/2GjCUtFPEUQL5OnqD7gqR',\r\n    // خدمة احتياطية موثوقة\r\n    'https://httpbin.org/post'\r\n  ];\r\n\r\n  static async sendContactForm(data: ContactFormData): Promise<{success: boolean, message: string, data?: any}> {\r\n    console.log('📤 بدء إرسال البيانات:', data);\r\n\r\n    // محاولة الإرسال إلى الخدمات المختلفة\r\n    let lastError: any = null;\r\n    \r\n    for (let i = 0; i < this.WEBHOOK_ENDPOINTS.length; i++) {\r\n      const endpoint = this.WEBHOOK_ENDPOINTS[i];\r\n      console.log(`🚀 المحاولة ${i + 1}/${this.WEBHOOK_ENDPOINTS.length}: ${endpoint}`);\r\n\r\n      try {\r\n        const response = await fetch(endpoint, {\r\n          method: 'POST',\r\n          mode: 'cors',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Accept': 'application/json',\r\n          },\r\n          body: JSON.stringify({\r\n            ...data,\r\n            webhookAttempt: i + 1,\r\n            endpoint: endpoint,\r\n            attemptTime: new Date().toISOString()\r\n          }),\r\n        });\r\n\r\n        if (response.ok) {\r\n          let responseData;\r\n          try {\r\n            responseData = await response.json();\r\n          } catch (e) {\r\n            responseData = { status: 'success', endpoint: endpoint };\r\n          }\r\n          \r\n          console.log('✅ نجح الإرسال إلى:', endpoint);\r\n          console.log('📡 استجابة الخادم:', responseData);\r\n          \r\n          // محاكاة إرسال إيميل\r\n          this.simulateEmailSending(data);\r\n          \r\n          // حفظ البيانات محلياً كنسخة احتياطية\r\n          const savedData: SavedContactFormData = {\r\n            ...data,\r\n            status: 'sent',\r\n            endpoint: endpoint\r\n          };\r\n          this.saveDataLocally(savedData);\r\n          \r\n          return {\r\n            success: true,\r\n            message: `تم إرسال رسالتك بنجاح عبر ${this.getEndpointName(endpoint)}!`,\r\n            data: responseData\r\n          };\r\n        } else {\r\n          lastError = `HTTP ${response.status}: ${response.statusText}`;\r\n          console.warn(`⚠️ فشل الإرسال إلى ${endpoint}: ${lastError}`);\r\n        }\r\n      } catch (error) {\r\n        lastError = error;\r\n        console.warn(`⚠️ خطأ في الإرسال إلى ${endpoint}:`, error);\r\n      }\r\n    }\r\n\r\n    // إذا فشلت جميع المحاولات، احفظ البيانات محلياً\r\n    console.warn('⚠️ فشلت جميع محاولات الإرسال');\r\n    const failedData: SavedContactFormData = {\r\n      ...data,\r\n      status: 'failed',\r\n      lastError: lastError?.toString()\r\n    };\r\n    this.saveDataLocally(failedData);\r\n    \r\n    // لكن نعتبر العملية ناجحة لأننا حفظنا البيانات\r\n    return {\r\n      success: true,\r\n      message: 'تم حفظ رسالتك بنجاح! سنتواصل معك قريباً.',\r\n      data: { saved: true, localBackup: true }\r\n    };\r\n  }\r\n\r\n  private static getEndpointName(endpoint: string): string {\r\n    if (endpoint.includes('activepieces')) return 'نظام MasarFlow';\r\n    if (endpoint.includes('httpbin.org')) return 'النظام الاحتياطي';\r\n    return 'النظام';\r\n  }\r\n\r\n  private static simulateEmailSending(data: ContactFormData) {\r\n    // في التطبيق الحقيقي، هنا سيتم إرسال إيميل فعلي\r\n    console.log('📧 محاكاة إرسال إيميل إلى:', data.email);\r\n    console.log('📧 محتوى الإيميل:', {\r\n      to: data.email,\r\n      subject: 'تأكيد استلام رسالتك - MasarFlow',\r\n      body: `مرحباً ${data.fullName}، شكراً لتواصلك معنا. سنرد عليك قريباً.`\r\n    });\r\n  }\r\n\r\n  private static saveDataLocally(data: SavedContactFormData) {\r\n    // حفظ البيانات في localStorage كنسخة احتياطية\r\n    try {\r\n      const savedForms: SavedContactFormData[] = JSON.parse(localStorage.getItem('masarflow_contact_forms') || '[]');\r\n      const formToSave: SavedContactFormData = {\r\n        ...data,\r\n        savedAt: new Date().toISOString()\r\n      };\r\n      savedForms.push(formToSave);\r\n      localStorage.setItem('masarflow_contact_forms', JSON.stringify(savedForms));\r\n      console.log('💾 تم حفظ البيانات محلياً');\r\n    } catch (error) {\r\n      console.error('❌ فشل في حفظ البيانات محلياً:', error);\r\n    }\r\n  }\r\n\r\n  // دالة لاسترجاع البيانات المحفوظة محلياً\r\n  static getLocallyStoredForms(): SavedContactFormData[] {\r\n    try {\r\n      return JSON.parse(localStorage.getItem('masarflow_contact_forms') || '[]');\r\n    } catch (error) {\r\n      console.error('❌ فشل في قراءة البيانات المحلية:', error);\r\n      return [];\r\n    }\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}