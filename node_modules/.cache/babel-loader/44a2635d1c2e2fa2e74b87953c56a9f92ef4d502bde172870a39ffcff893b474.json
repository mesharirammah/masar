{"ast":null,"code":"import _objectSpread from\"C:/Users/\\u0629/Desktop/masarflow-website/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// خدمة الويب هوك - تتعامل مع إرسال البيانات بطرق متعددة\n// نوع البيانات للحفظ المحلي مع معلومات إضافية\nexport class WebhookService{static async sendContactForm(data){var _lastError;console.log('📤 بدء إرسال البيانات:',data);console.log('🔗 الروابط المتاحة:',this.WEBHOOK_ENDPOINTS);// محاولة الإرسال إلى الخدمات المختلفة\nlet lastError=null;for(let i=0;i<this.WEBHOOK_ENDPOINTS.length;i++){const endpoint=this.WEBHOOK_ENDPOINTS[i];console.log(\"\\uD83D\\uDE80 \\u0627\\u0644\\u0645\\u062D\\u0627\\u0648\\u0644\\u0629 \".concat(i+1,\"/\").concat(this.WEBHOOK_ENDPOINTS.length,\": \").concat(endpoint));try{const requestData=_objectSpread(_objectSpread({},data),{},{webhookAttempt:i+1,attemptTime:new Date().toISOString()});console.log(\"\\uD83D\\uDCE4 \\u0625\\u0631\\u0633\\u0627\\u0644 \\u0627\\u0644\\u0628\\u064A\\u0627\\u0646\\u0627\\u062A \\u0625\\u0644\\u0649 \".concat(endpoint,\":\"),requestData);const response=await fetch(endpoint,{method:'POST',mode:'cors',headers:{'Content-Type':'application/json','Accept':'application/json','User-Agent':'MasarFlow-ContactForm/1.0'},body:JSON.stringify(requestData)});console.log(\"\\uD83D\\uDCE1 \\u0627\\u0633\\u062A\\u062C\\u0627\\u0628\\u0629 \\u0645\\u0646 \".concat(endpoint,\":\"),{status:response.status,statusText:response.statusText,ok:response.ok});if(response.ok){let responseData;try{responseData=await response.json();}catch(e){responseData={status:'success',endpoint:endpoint};}console.log('✅ نجح الإرسال إلى:',endpoint);console.log('📡 استجابة الخادم:',responseData);// محاكاة إرسال إيميل\nthis.simulateEmailSending(data);// حفظ البيانات محلياً كنسخة احتياطية\nconst savedData=_objectSpread(_objectSpread({},data),{},{status:'sent',endpoint:endpoint});this.saveDataLocally(savedData);return{success:true,message:\"\\u062A\\u0645 \\u0625\\u0631\\u0633\\u0627\\u0644 \\u0631\\u0633\\u0627\\u0644\\u062A\\u0643 \\u0628\\u0646\\u062C\\u0627\\u062D \\u0639\\u0628\\u0631 \".concat(this.getEndpointName(endpoint),\"!\"),data:responseData};}else{lastError=\"HTTP \".concat(response.status,\": \").concat(response.statusText);console.warn(\"\\u26A0\\uFE0F \\u0641\\u0634\\u0644 \\u0627\\u0644\\u0625\\u0631\\u0633\\u0627\\u0644 \\u0625\\u0644\\u0649 \".concat(endpoint,\": \").concat(lastError));}}catch(error){lastError=error;console.warn(\"\\u26A0\\uFE0F \\u062E\\u0637\\u0623 \\u0641\\u064A \\u0627\\u0644\\u0625\\u0631\\u0633\\u0627\\u0644 \\u0625\\u0644\\u0649 \".concat(endpoint,\":\"),error);}}// إذا فشلت جميع المحاولات، احفظ البيانات محلياً\nconsole.warn('⚠️ فشلت جميع محاولات الإرسال');const failedData=_objectSpread(_objectSpread({},data),{},{status:'failed',lastError:(_lastError=lastError)===null||_lastError===void 0?void 0:_lastError.toString()});this.saveDataLocally(failedData);// إرجاع فشل العملية\nreturn{success:false,message:'حدث خطأ في الإرسال. يرجى المحاولة مرة أخرى.',data:{saved:true,localBackup:true,error:lastError}};}static getEndpointName(endpoint){if(endpoint.includes('/api/contact'))return'نظام Activepieces عبر Netlify';if(endpoint.includes('activepieces'))return'نظام Activepieces';return'النظام';}static simulateEmailSending(data){// في التطبيق الحقيقي، هنا سيتم إرسال إيميل فعلي\nconsole.log('📧 محاكاة إرسال إيميل إلى:',data.email);console.log('📧 محتوى الإيميل:',{to:data.email,subject:'تأكيد استلام رسالتك - MasarFlow',body:\"\\u0645\\u0631\\u062D\\u0628\\u0627\\u064B \".concat(data.fullName,\"\\u060C \\u0634\\u0643\\u0631\\u0627\\u064B \\u0644\\u062A\\u0648\\u0627\\u0635\\u0644\\u0643 \\u0645\\u0639\\u0646\\u0627. \\u0633\\u0646\\u0631\\u062F \\u0639\\u0644\\u064A\\u0643 \\u0642\\u0631\\u064A\\u0628\\u0627\\u064B.\")});}static saveDataLocally(data){// حفظ البيانات في localStorage كنسخة احتياطية\ntry{const savedForms=JSON.parse(localStorage.getItem('masarflow_contact_forms')||'[]');const formToSave=_objectSpread(_objectSpread({},data),{},{savedAt:new Date().toISOString()});savedForms.push(formToSave);localStorage.setItem('masarflow_contact_forms',JSON.stringify(savedForms));console.log('💾 تم حفظ البيانات محلياً');}catch(error){console.error('❌ فشل في حفظ البيانات محلياً:',error);}}// دالة لاسترجاع البيانات المحفوظة محلياً\nstatic getLocallyStoredForms(){try{return JSON.parse(localStorage.getItem('masarflow_contact_forms')||'[]');}catch(error){console.error('❌ فشل في قراءة البيانات المحلية:',error);return[];}}}WebhookService.WEBHOOK_ENDPOINTS=[// رابط الويب هوك عبر Netlify proxy\n'/api/contact'];","map":{"version":3,"names":["WebhookService","sendContactForm","data","_lastError","console","log","WEBHOOK_ENDPOINTS","lastError","i","length","endpoint","concat","requestData","_objectSpread","webhookAttempt","attemptTime","Date","toISOString","response","fetch","method","mode","headers","body","JSON","stringify","status","statusText","ok","responseData","json","e","simulateEmailSending","savedData","saveDataLocally","success","message","getEndpointName","warn","error","failedData","toString","saved","localBackup","includes","email","to","subject","fullName","savedForms","parse","localStorage","getItem","formToSave","savedAt","push","setItem","getLocallyStoredForms"],"sources":["C:/Users/ة/Desktop/masarflow-website/src/utils/webhookService.ts"],"sourcesContent":["// خدمة الويب هوك - تتعامل مع إرسال البيانات بطرق متعددة\nexport interface ContactFormData {\n  fullName: string;\n  email: string;\n  phone?: string;\n  company?: string;\n  service: string;\n  message: string;\n  timestamp: string;\n  source: string;\n}\n\n// نوع البيانات للحفظ المحلي مع معلومات إضافية\nexport interface SavedContactFormData extends ContactFormData {\n  status?: 'sent' | 'failed' | 'pending';\n  endpoint?: string;\n  lastError?: string;\n  savedAt?: string;\n}\n\nexport class WebhookService {\n  private static readonly WEBHOOK_ENDPOINTS = [\n    // رابط الويب هوك عبر Netlify proxy\n    '/api/contact'\n  ];\n\n  static async sendContactForm(data: ContactFormData): Promise<{success: boolean, message: string, data?: any}> {\n    console.log('📤 بدء إرسال البيانات:', data);\n    console.log('🔗 الروابط المتاحة:', this.WEBHOOK_ENDPOINTS);\n\n    // محاولة الإرسال إلى الخدمات المختلفة\n    let lastError: any = null;\n    \n    for (let i = 0; i < this.WEBHOOK_ENDPOINTS.length; i++) {\n      const endpoint = this.WEBHOOK_ENDPOINTS[i];\n      console.log(`🚀 المحاولة ${i + 1}/${this.WEBHOOK_ENDPOINTS.length}: ${endpoint}`);\n\n      try {\n        const requestData = {\n          ...data,\n          webhookAttempt: i + 1,\n          attemptTime: new Date().toISOString()\n        };\n        \n        console.log(`📤 إرسال البيانات إلى ${endpoint}:`, requestData);\n        \n        const response = await fetch(endpoint, {\n          method: 'POST',\n          mode: 'cors',\n          headers: {\n            'Content-Type': 'application/json',\n            'Accept': 'application/json',\n            'User-Agent': 'MasarFlow-ContactForm/1.0'\n          },\n          body: JSON.stringify(requestData),\n        });\n        \n        console.log(`📡 استجابة من ${endpoint}:`, {\n          status: response.status,\n          statusText: response.statusText,\n          ok: response.ok\n        });\n\n        if (response.ok) {\n          let responseData;\n          try {\n            responseData = await response.json();\n          } catch (e) {\n            responseData = { status: 'success', endpoint: endpoint };\n          }\n          \n          console.log('✅ نجح الإرسال إلى:', endpoint);\n          console.log('📡 استجابة الخادم:', responseData);\n          \n          // محاكاة إرسال إيميل\n          this.simulateEmailSending(data);\n          \n          // حفظ البيانات محلياً كنسخة احتياطية\n          const savedData: SavedContactFormData = {\n            ...data,\n            status: 'sent',\n            endpoint: endpoint\n          };\n          this.saveDataLocally(savedData);\n          \n          return {\n            success: true,\n            message: `تم إرسال رسالتك بنجاح عبر ${this.getEndpointName(endpoint)}!`,\n            data: responseData\n          };\n        } else {\n          lastError = `HTTP ${response.status}: ${response.statusText}`;\n          console.warn(`⚠️ فشل الإرسال إلى ${endpoint}: ${lastError}`);\n        }\n      } catch (error) {\n        lastError = error;\n        console.warn(`⚠️ خطأ في الإرسال إلى ${endpoint}:`, error);\n      }\n    }\n\n    // إذا فشلت جميع المحاولات، احفظ البيانات محلياً\n    console.warn('⚠️ فشلت جميع محاولات الإرسال');\n    const failedData: SavedContactFormData = {\n      ...data,\n      status: 'failed',\n      lastError: lastError?.toString()\n    };\n    this.saveDataLocally(failedData);\n    \n    // إرجاع فشل العملية\n    return {\n      success: false,\n      message: 'حدث خطأ في الإرسال. يرجى المحاولة مرة أخرى.',\n      data: { saved: true, localBackup: true, error: lastError }\n    };\n  }\n\n  private static getEndpointName(endpoint: string): string {\n    if (endpoint.includes('/api/contact')) return 'نظام Activepieces عبر Netlify';\n    if (endpoint.includes('activepieces')) return 'نظام Activepieces';\n    return 'النظام';\n  }\n\n  private static simulateEmailSending(data: ContactFormData) {\n    // في التطبيق الحقيقي، هنا سيتم إرسال إيميل فعلي\n    console.log('📧 محاكاة إرسال إيميل إلى:', data.email);\n    console.log('📧 محتوى الإيميل:', {\n      to: data.email,\n      subject: 'تأكيد استلام رسالتك - MasarFlow',\n      body: `مرحباً ${data.fullName}، شكراً لتواصلك معنا. سنرد عليك قريباً.`\n    });\n  }\n\n  private static saveDataLocally(data: SavedContactFormData) {\n    // حفظ البيانات في localStorage كنسخة احتياطية\n    try {\n      const savedForms: SavedContactFormData[] = JSON.parse(localStorage.getItem('masarflow_contact_forms') || '[]');\n      const formToSave: SavedContactFormData = {\n        ...data,\n        savedAt: new Date().toISOString()\n      };\n      savedForms.push(formToSave);\n      localStorage.setItem('masarflow_contact_forms', JSON.stringify(savedForms));\n      console.log('💾 تم حفظ البيانات محلياً');\n    } catch (error) {\n      console.error('❌ فشل في حفظ البيانات محلياً:', error);\n    }\n  }\n\n  // دالة لاسترجاع البيانات المحفوظة محلياً\n  static getLocallyStoredForms(): SavedContactFormData[] {\n    try {\n      return JSON.parse(localStorage.getItem('masarflow_contact_forms') || '[]');\n    } catch (error) {\n      console.error('❌ فشل في قراءة البيانات المحلية:', error);\n      return [];\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}