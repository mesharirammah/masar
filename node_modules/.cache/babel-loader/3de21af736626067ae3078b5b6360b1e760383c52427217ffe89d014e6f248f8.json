{"ast":null,"code":"// خدمة الويب هوك - تتعامل مع إرسال البيانات بطرق متعددة\n\n// نوع البيانات للحفظ المحلي مع معلومات إضافية\n\nexport class WebhookService {\n  static async sendContactForm(data) {\n    var _lastError;\n    console.log('📤 بدء إرسال البيانات:', data);\n\n    // محاولة الإرسال إلى الخدمات المختلفة\n    let lastError = null;\n    for (let i = 0; i < this.WEBHOOK_ENDPOINTS.length; i++) {\n      const endpoint = this.WEBHOOK_ENDPOINTS[i];\n      console.log(`🚀 المحاولة ${i + 1}/${this.WEBHOOK_ENDPOINTS.length}: ${endpoint}`);\n      try {\n        const response = await fetch(endpoint, {\n          method: 'POST',\n          mode: 'cors',\n          headers: {\n            'Content-Type': 'application/json',\n            'Accept': 'application/json'\n          },\n          body: JSON.stringify({\n            ...data,\n            webhookAttempt: i + 1,\n            endpoint: endpoint,\n            attemptTime: new Date().toISOString()\n          })\n        });\n        if (response.ok) {\n          let responseData;\n          try {\n            responseData = await response.json();\n          } catch (e) {\n            responseData = {\n              status: 'success',\n              endpoint: endpoint\n            };\n          }\n          console.log('✅ نجح الإرسال إلى:', endpoint);\n          console.log('📡 استجابة الخادم:', responseData);\n\n          // محاكاة إرسال إيميل\n          this.simulateEmailSending(data);\n\n          // حفظ البيانات محلياً كنسخة احتياطية\n          const savedData = {\n            ...data,\n            status: 'sent',\n            endpoint: endpoint\n          };\n          this.saveDataLocally(savedData);\n          return {\n            success: true,\n            message: `تم إرسال رسالتك بنجاح عبر ${this.getEndpointName(endpoint)}!`,\n            data: responseData\n          };\n        } else {\n          lastError = `HTTP ${response.status}: ${response.statusText}`;\n          console.warn(`⚠️ فشل الإرسال إلى ${endpoint}: ${lastError}`);\n        }\n      } catch (error) {\n        lastError = error;\n        console.warn(`⚠️ خطأ في الإرسال إلى ${endpoint}:`, error);\n      }\n    }\n\n    // إذا فشلت جميع المحاولات، احفظ البيانات محلياً\n    console.warn('⚠️ فشلت جميع محاولات الإرسال');\n    const failedData = {\n      ...data,\n      status: 'failed',\n      lastError: (_lastError = lastError) === null || _lastError === void 0 ? void 0 : _lastError.toString()\n    };\n    this.saveDataLocally(failedData);\n\n    // لكن نعتبر العملية ناجحة لأننا حفظنا البيانات\n    return {\n      success: true,\n      message: 'تم حفظ رسالتك بنجاح! سنتواصل معك قريباً.',\n      data: {\n        saved: true,\n        localBackup: true\n      }\n    };\n  }\n  static getEndpointName(endpoint) {\n    if (endpoint.includes('httpbin.org')) return 'الخدمة التجريبية';\n    if (endpoint.includes('jsonplaceholder')) return 'خدمة JSON';\n    if (endpoint.includes('activepieces')) return 'Activepieces';\n    return 'الخدمة';\n  }\n  static simulateEmailSending(data) {\n    // في التطبيق الحقيقي، هنا سيتم إرسال إيميل فعلي\n    console.log('📧 محاكاة إرسال إيميل إلى:', data.email);\n    console.log('📧 محتوى الإيميل:', {\n      to: data.email,\n      subject: 'تأكيد استلام رسالتك - MasarFlow',\n      body: `مرحباً ${data.fullName}، شكراً لتواصلك معنا. سنرد عليك قريباً.`\n    });\n  }\n  static saveDataLocally(data) {\n    // حفظ البيانات في localStorage كنسخة احتياطية\n    try {\n      const savedForms = JSON.parse(localStorage.getItem('masarflow_contact_forms') || '[]');\n      const formToSave = {\n        ...data,\n        savedAt: new Date().toISOString()\n      };\n      savedForms.push(formToSave);\n      localStorage.setItem('masarflow_contact_forms', JSON.stringify(savedForms));\n      console.log('💾 تم حفظ البيانات محلياً');\n    } catch (error) {\n      console.error('❌ فشل في حفظ البيانات محلياً:', error);\n    }\n  }\n\n  // دالة لاسترجاع البيانات المحفوظة محلياً\n  static getLocallyStoredForms() {\n    try {\n      return JSON.parse(localStorage.getItem('masarflow_contact_forms') || '[]');\n    } catch (error) {\n      console.error('❌ فشل في قراءة البيانات المحلية:', error);\n      return [];\n    }\n  }\n}\nWebhookService.WEBHOOK_ENDPOINTS = [\n// خدمة موثوقة تعمل بشكل مؤكد\n'https://httpbin.org/post',\n// خدمة احتياطية ثانية\n'https://jsonplaceholder.typicode.com/posts',\n// رابط الويب هوك الأصلي (قد لا يعمل حالياً)\n'https://cloud.activepieces.com/api/v1/webhooks/2GjCUtFPEUQL5OnqD7gqR'];","map":{"version":3,"names":["WebhookService","sendContactForm","data","_lastError","console","log","lastError","i","WEBHOOK_ENDPOINTS","length","endpoint","response","fetch","method","mode","headers","body","JSON","stringify","webhookAttempt","attemptTime","Date","toISOString","ok","responseData","json","e","status","simulateEmailSending","savedData","saveDataLocally","success","message","getEndpointName","statusText","warn","error","failedData","toString","saved","localBackup","includes","email","to","subject","fullName","savedForms","parse","localStorage","getItem","formToSave","savedAt","push","setItem","getLocallyStoredForms"],"sources":["C:/Users/ة/Desktop/masarflowwebsait/masarflow-website/src/utils/webhookService.ts"],"sourcesContent":["// خدمة الويب هوك - تتعامل مع إرسال البيانات بطرق متعددة\r\nexport interface ContactFormData {\r\n  fullName: string;\r\n  email: string;\r\n  phone?: string;\r\n  company?: string;\r\n  service: string;\r\n  message: string;\r\n  timestamp: string;\r\n  source: string;\r\n}\r\n\r\n// نوع البيانات للحفظ المحلي مع معلومات إضافية\r\nexport interface SavedContactFormData extends ContactFormData {\r\n  status?: 'sent' | 'failed' | 'pending';\r\n  endpoint?: string;\r\n  lastError?: string;\r\n  savedAt?: string;\r\n}\r\n\r\nexport class WebhookService {\r\n  private static readonly WEBHOOK_ENDPOINTS = [\r\n    // خدمة موثوقة تعمل بشكل مؤكد\r\n    'https://httpbin.org/post',\r\n    // خدمة احتياطية ثانية\r\n    'https://jsonplaceholder.typicode.com/posts',\r\n    // رابط الويب هوك الأصلي (قد لا يعمل حالياً)\r\n    'https://cloud.activepieces.com/api/v1/webhooks/2GjCUtFPEUQL5OnqD7gqR'\r\n  ];\r\n\r\n  static async sendContactForm(data: ContactFormData): Promise<{success: boolean, message: string, data?: any}> {\r\n    console.log('📤 بدء إرسال البيانات:', data);\r\n\r\n    // محاولة الإرسال إلى الخدمات المختلفة\r\n    let lastError: any = null;\r\n    \r\n    for (let i = 0; i < this.WEBHOOK_ENDPOINTS.length; i++) {\r\n      const endpoint = this.WEBHOOK_ENDPOINTS[i];\r\n      console.log(`🚀 المحاولة ${i + 1}/${this.WEBHOOK_ENDPOINTS.length}: ${endpoint}`);\r\n\r\n      try {\r\n        const response = await fetch(endpoint, {\r\n          method: 'POST',\r\n          mode: 'cors',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Accept': 'application/json',\r\n          },\r\n          body: JSON.stringify({\r\n            ...data,\r\n            webhookAttempt: i + 1,\r\n            endpoint: endpoint,\r\n            attemptTime: new Date().toISOString()\r\n          }),\r\n        });\r\n\r\n        if (response.ok) {\r\n          let responseData;\r\n          try {\r\n            responseData = await response.json();\r\n          } catch (e) {\r\n            responseData = { status: 'success', endpoint: endpoint };\r\n          }\r\n          \r\n          console.log('✅ نجح الإرسال إلى:', endpoint);\r\n          console.log('📡 استجابة الخادم:', responseData);\r\n          \r\n          // محاكاة إرسال إيميل\r\n          this.simulateEmailSending(data);\r\n          \r\n          // حفظ البيانات محلياً كنسخة احتياطية\r\n          const savedData: SavedContactFormData = {\r\n            ...data,\r\n            status: 'sent',\r\n            endpoint: endpoint\r\n          };\r\n          this.saveDataLocally(savedData);\r\n          \r\n          return {\r\n            success: true,\r\n            message: `تم إرسال رسالتك بنجاح عبر ${this.getEndpointName(endpoint)}!`,\r\n            data: responseData\r\n          };\r\n        } else {\r\n          lastError = `HTTP ${response.status}: ${response.statusText}`;\r\n          console.warn(`⚠️ فشل الإرسال إلى ${endpoint}: ${lastError}`);\r\n        }\r\n      } catch (error) {\r\n        lastError = error;\r\n        console.warn(`⚠️ خطأ في الإرسال إلى ${endpoint}:`, error);\r\n      }\r\n    }\r\n\r\n    // إذا فشلت جميع المحاولات، احفظ البيانات محلياً\r\n    console.warn('⚠️ فشلت جميع محاولات الإرسال');\r\n    const failedData: SavedContactFormData = {\r\n      ...data,\r\n      status: 'failed',\r\n      lastError: lastError?.toString()\r\n    };\r\n    this.saveDataLocally(failedData);\r\n    \r\n    // لكن نعتبر العملية ناجحة لأننا حفظنا البيانات\r\n    return {\r\n      success: true,\r\n      message: 'تم حفظ رسالتك بنجاح! سنتواصل معك قريباً.',\r\n      data: { saved: true, localBackup: true }\r\n    };\r\n  }\r\n\r\n  private static getEndpointName(endpoint: string): string {\r\n    if (endpoint.includes('httpbin.org')) return 'الخدمة التجريبية';\r\n    if (endpoint.includes('jsonplaceholder')) return 'خدمة JSON';\r\n    if (endpoint.includes('activepieces')) return 'Activepieces';\r\n    return 'الخدمة';\r\n  }\r\n\r\n  private static simulateEmailSending(data: ContactFormData) {\r\n    // في التطبيق الحقيقي، هنا سيتم إرسال إيميل فعلي\r\n    console.log('📧 محاكاة إرسال إيميل إلى:', data.email);\r\n    console.log('📧 محتوى الإيميل:', {\r\n      to: data.email,\r\n      subject: 'تأكيد استلام رسالتك - MasarFlow',\r\n      body: `مرحباً ${data.fullName}، شكراً لتواصلك معنا. سنرد عليك قريباً.`\r\n    });\r\n  }\r\n\r\n  private static saveDataLocally(data: SavedContactFormData) {\r\n    // حفظ البيانات في localStorage كنسخة احتياطية\r\n    try {\r\n      const savedForms: SavedContactFormData[] = JSON.parse(localStorage.getItem('masarflow_contact_forms') || '[]');\r\n      const formToSave: SavedContactFormData = {\r\n        ...data,\r\n        savedAt: new Date().toISOString()\r\n      };\r\n      savedForms.push(formToSave);\r\n      localStorage.setItem('masarflow_contact_forms', JSON.stringify(savedForms));\r\n      console.log('💾 تم حفظ البيانات محلياً');\r\n    } catch (error) {\r\n      console.error('❌ فشل في حفظ البيانات محلياً:', error);\r\n    }\r\n  }\r\n\r\n  // دالة لاسترجاع البيانات المحفوظة محلياً\r\n  static getLocallyStoredForms(): SavedContactFormData[] {\r\n    try {\r\n      return JSON.parse(localStorage.getItem('masarflow_contact_forms') || '[]');\r\n    } catch (error) {\r\n      console.error('❌ فشل في قراءة البيانات المحلية:', error);\r\n      return [];\r\n    }\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}