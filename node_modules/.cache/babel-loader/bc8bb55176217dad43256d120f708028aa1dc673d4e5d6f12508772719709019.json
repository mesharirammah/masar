{"ast":null,"code":"// خدمة الويب هوك - تتعامل مع إرسال البيانات بطرق متعددة\n\n// نوع البيانات للحفظ المحلي مع معلومات إضافية\n\nexport class WebhookService {\n  static async sendContactForm(data) {\n    var _lastError;\n    console.log('📤 بدء إرسال البيانات:', data);\n    console.log('🔗 الروابط المتاحة:', this.WEBHOOK_ENDPOINTS);\n\n    // محاولة الإرسال إلى الخدمات المختلفة\n    let lastError = null;\n    for (let i = 0; i < this.WEBHOOK_ENDPOINTS.length; i++) {\n      const endpoint = this.WEBHOOK_ENDPOINTS[i];\n      console.log(`🚀 المحاولة ${i + 1}/${this.WEBHOOK_ENDPOINTS.length}: ${endpoint}`);\n      try {\n        const requestData = {\n          ...data,\n          webhookAttempt: i + 1,\n          attemptTime: new Date().toISOString()\n        };\n        console.log(`📤 إرسال البيانات إلى ${endpoint}:`, requestData);\n        const response = await fetch(endpoint, {\n          method: 'POST',\n          mode: 'cors',\n          headers: {\n            'Content-Type': 'application/json',\n            'Accept': 'application/json'\n          },\n          body: JSON.stringify(requestData)\n        });\n        console.log(`📡 استجابة من ${endpoint}:`, {\n          status: response.status,\n          statusText: response.statusText,\n          ok: response.ok\n        });\n        if (response.ok) {\n          let responseData;\n          try {\n            responseData = await response.json();\n          } catch (e) {\n            responseData = {\n              status: 'success',\n              endpoint: endpoint\n            };\n          }\n          console.log('✅ نجح الإرسال إلى:', endpoint);\n          console.log('📡 استجابة الخادم:', responseData);\n\n          // محاكاة إرسال إيميل\n          this.simulateEmailSending(data);\n\n          // حفظ البيانات محلياً كنسخة احتياطية\n          const savedData = {\n            ...data,\n            status: 'sent',\n            endpoint: endpoint\n          };\n          this.saveDataLocally(savedData);\n          return {\n            success: true,\n            message: `تم إرسال رسالتك بنجاح عبر ${this.getEndpointName(endpoint)}!`,\n            data: responseData\n          };\n        } else {\n          lastError = `HTTP ${response.status}: ${response.statusText}`;\n          console.warn(`⚠️ فشل الإرسال إلى ${endpoint}: ${lastError}`);\n        }\n      } catch (error) {\n        lastError = error;\n        console.warn(`⚠️ خطأ في الإرسال إلى ${endpoint}:`, error);\n      }\n    }\n\n    // إذا فشلت جميع المحاولات، احفظ البيانات محلياً\n    console.warn('⚠️ فشلت جميع محاولات الإرسال');\n    const failedData = {\n      ...data,\n      status: 'failed',\n      lastError: (_lastError = lastError) === null || _lastError === void 0 ? void 0 : _lastError.toString()\n    };\n    this.saveDataLocally(failedData);\n\n    // إرجاع فشل العملية\n    return {\n      success: false,\n      message: 'حدث خطأ في الإرسال. يرجى المحاولة مرة أخرى.',\n      data: {\n        saved: true,\n        localBackup: true,\n        error: lastError\n      }\n    };\n  }\n  static getEndpointName(endpoint) {\n    if (endpoint.includes('activepieces')) return 'نظام Activepieces';\n    return 'النظام';\n  }\n  static simulateEmailSending(data) {\n    // في التطبيق الحقيقي، هنا سيتم إرسال إيميل فعلي\n    console.log('📧 محاكاة إرسال إيميل إلى:', data.email);\n    console.log('📧 محتوى الإيميل:', {\n      to: data.email,\n      subject: 'تأكيد استلام رسالتك - MasarFlow',\n      body: `مرحباً ${data.fullName}، شكراً لتواصلك معنا. سنرد عليك قريباً.`\n    });\n  }\n  static saveDataLocally(data) {\n    // حفظ البيانات في localStorage كنسخة احتياطية\n    try {\n      const savedForms = JSON.parse(localStorage.getItem('masarflow_contact_forms') || '[]');\n      const formToSave = {\n        ...data,\n        savedAt: new Date().toISOString()\n      };\n      savedForms.push(formToSave);\n      localStorage.setItem('masarflow_contact_forms', JSON.stringify(savedForms));\n      console.log('💾 تم حفظ البيانات محلياً');\n    } catch (error) {\n      console.error('❌ فشل في حفظ البيانات محلياً:', error);\n    }\n  }\n\n  // دالة لاسترجاع البيانات المحفوظة محلياً\n  static getLocallyStoredForms() {\n    try {\n      return JSON.parse(localStorage.getItem('masarflow_contact_forms') || '[]');\n    } catch (error) {\n      console.error('❌ فشل في قراءة البيانات المحلية:', error);\n      return [];\n    }\n  }\n}\nWebhookService.WEBHOOK_ENDPOINTS = [\n// رابط الويب هوك الرئيسي لـ Activepieces\n'https://cloud.activepieces.com/api/v1/webhooks/O4RKo8kmQwsTORFYUZzm9'];","map":{"version":3,"names":["WebhookService","sendContactForm","data","_lastError","console","log","WEBHOOK_ENDPOINTS","lastError","i","length","endpoint","requestData","webhookAttempt","attemptTime","Date","toISOString","response","fetch","method","mode","headers","body","JSON","stringify","status","statusText","ok","responseData","json","e","simulateEmailSending","savedData","saveDataLocally","success","message","getEndpointName","warn","error","failedData","toString","saved","localBackup","includes","email","to","subject","fullName","savedForms","parse","localStorage","getItem","formToSave","savedAt","push","setItem","getLocallyStoredForms"],"sources":["C:/Users/ة/Desktop/masarflow-website/src/utils/webhookService.ts"],"sourcesContent":["// خدمة الويب هوك - تتعامل مع إرسال البيانات بطرق متعددة\r\nexport interface ContactFormData {\r\n  fullName: string;\r\n  email: string;\r\n  phone?: string;\r\n  company?: string;\r\n  service: string;\r\n  message: string;\r\n  timestamp: string;\r\n  source: string;\r\n}\r\n\r\n// نوع البيانات للحفظ المحلي مع معلومات إضافية\r\nexport interface SavedContactFormData extends ContactFormData {\r\n  status?: 'sent' | 'failed' | 'pending';\r\n  endpoint?: string;\r\n  lastError?: string;\r\n  savedAt?: string;\r\n}\r\n\r\nexport class WebhookService {\r\n  private static readonly WEBHOOK_ENDPOINTS = [\r\n    // رابط الويب هوك الرئيسي لـ Activepieces\r\n    'https://cloud.activepieces.com/api/v1/webhooks/O4RKo8kmQwsTORFYUZzm9'\r\n  ];\r\n\r\n  static async sendContactForm(data: ContactFormData): Promise<{success: boolean, message: string, data?: any}> {\r\n    console.log('📤 بدء إرسال البيانات:', data);\r\n    console.log('🔗 الروابط المتاحة:', this.WEBHOOK_ENDPOINTS);\r\n\r\n    // محاولة الإرسال إلى الخدمات المختلفة\r\n    let lastError: any = null;\r\n    \r\n    for (let i = 0; i < this.WEBHOOK_ENDPOINTS.length; i++) {\r\n      const endpoint = this.WEBHOOK_ENDPOINTS[i];\r\n      console.log(`🚀 المحاولة ${i + 1}/${this.WEBHOOK_ENDPOINTS.length}: ${endpoint}`);\r\n\r\n      try {\r\n        const requestData = {\r\n          ...data,\r\n          webhookAttempt: i + 1,\r\n          attemptTime: new Date().toISOString()\r\n        };\r\n        \r\n        console.log(`📤 إرسال البيانات إلى ${endpoint}:`, requestData);\r\n        \r\n        const response = await fetch(endpoint, {\r\n          method: 'POST',\r\n          mode: 'cors',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Accept': 'application/json'\r\n          },\r\n          body: JSON.stringify(requestData),\r\n        });\r\n        \r\n        console.log(`📡 استجابة من ${endpoint}:`, {\r\n          status: response.status,\r\n          statusText: response.statusText,\r\n          ok: response.ok\r\n        });\r\n\r\n        if (response.ok) {\r\n          let responseData;\r\n          try {\r\n            responseData = await response.json();\r\n          } catch (e) {\r\n            responseData = { status: 'success', endpoint: endpoint };\r\n          }\r\n          \r\n          console.log('✅ نجح الإرسال إلى:', endpoint);\r\n          console.log('📡 استجابة الخادم:', responseData);\r\n          \r\n          // محاكاة إرسال إيميل\r\n          this.simulateEmailSending(data);\r\n          \r\n          // حفظ البيانات محلياً كنسخة احتياطية\r\n          const savedData: SavedContactFormData = {\r\n            ...data,\r\n            status: 'sent',\r\n            endpoint: endpoint\r\n          };\r\n          this.saveDataLocally(savedData);\r\n          \r\n          return {\r\n            success: true,\r\n            message: `تم إرسال رسالتك بنجاح عبر ${this.getEndpointName(endpoint)}!`,\r\n            data: responseData\r\n          };\r\n        } else {\r\n          lastError = `HTTP ${response.status}: ${response.statusText}`;\r\n          console.warn(`⚠️ فشل الإرسال إلى ${endpoint}: ${lastError}`);\r\n        }\r\n      } catch (error) {\r\n        lastError = error;\r\n        console.warn(`⚠️ خطأ في الإرسال إلى ${endpoint}:`, error);\r\n      }\r\n    }\r\n\r\n    // إذا فشلت جميع المحاولات، احفظ البيانات محلياً\r\n    console.warn('⚠️ فشلت جميع محاولات الإرسال');\r\n    const failedData: SavedContactFormData = {\r\n      ...data,\r\n      status: 'failed',\r\n      lastError: lastError?.toString()\r\n    };\r\n    this.saveDataLocally(failedData);\r\n    \r\n    // إرجاع فشل العملية\r\n    return {\r\n      success: false,\r\n      message: 'حدث خطأ في الإرسال. يرجى المحاولة مرة أخرى.',\r\n      data: { saved: true, localBackup: true, error: lastError }\r\n    };\r\n  }\r\n\r\n  private static getEndpointName(endpoint: string): string {\r\n    if (endpoint.includes('activepieces')) return 'نظام Activepieces';\r\n    return 'النظام';\r\n  }\r\n\r\n  private static simulateEmailSending(data: ContactFormData) {\r\n    // في التطبيق الحقيقي، هنا سيتم إرسال إيميل فعلي\r\n    console.log('📧 محاكاة إرسال إيميل إلى:', data.email);\r\n    console.log('📧 محتوى الإيميل:', {\r\n      to: data.email,\r\n      subject: 'تأكيد استلام رسالتك - MasarFlow',\r\n      body: `مرحباً ${data.fullName}، شكراً لتواصلك معنا. سنرد عليك قريباً.`\r\n    });\r\n  }\r\n\r\n  private static saveDataLocally(data: SavedContactFormData) {\r\n    // حفظ البيانات في localStorage كنسخة احتياطية\r\n    try {\r\n      const savedForms: SavedContactFormData[] = JSON.parse(localStorage.getItem('masarflow_contact_forms') || '[]');\r\n      const formToSave: SavedContactFormData = {\r\n        ...data,\r\n        savedAt: new Date().toISOString()\r\n      };\r\n      savedForms.push(formToSave);\r\n      localStorage.setItem('masarflow_contact_forms', JSON.stringify(savedForms));\r\n      console.log('💾 تم حفظ البيانات محلياً');\r\n    } catch (error) {\r\n      console.error('❌ فشل في حفظ البيانات محلياً:', error);\r\n    }\r\n  }\r\n\r\n  // دالة لاسترجاع البيانات المحفوظة محلياً\r\n  static getLocallyStoredForms(): SavedContactFormData[] {\r\n    try {\r\n      return JSON.parse(localStorage.getItem('masarflow_contact_forms') || '[]');\r\n    } catch (error) {\r\n      console.error('❌ فشل في قراءة البيانات المحلية:', error);\r\n      return [];\r\n    }\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}